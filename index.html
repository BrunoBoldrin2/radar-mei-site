<!DOCTYPE html>
<html>
<head>
  <title>Radar MEI</title>
  <meta charset="UTF-8">
</head>

<body style="font-family: Arial; text-align:center; margin-top:50px;">

<h1>Radar MEI</h1>
<p>Descubra se você vai ultrapassar o limite do MEI</p>

<input id="valor" type="number" placeholder="Faturamento mensal" />
<br><br>

<button id="botao" onclick="analisar()">Analisar risco</button>

  <p id="loading" style="display:none; font-weight:bold;">
  Analisando sua situação...
</p>



<div id="resultado" style="
  margin-top:30px;
  font-size:22px;
  font-weight:bold;
  padding:20px;
  border-radius:10px;
  display:inline-block;
"></div>

  
  <script>
async function analisar() {

  const valorInput = document.getElementById("valor");
  const valor = valorInput.value;
  const botao = document.getElementById("botao");
  const loading = document.getElementById("loading");
  const resultado = document.getElementById("resultado");

  if (!valor || valor <= 0) {
    alert("Digite um valor válido.");
    return;
  }

  botao.disabled = true;
  botao.innerText = "Analisando...";
  loading.style.display = "block";
  resultado.innerHTML = "";

  try {

    const resposta = await fetch(
      "https://radar-mei-api-production.up.railway.app/simular?valor=" + valor
    );

    const dados = await resposta.json();

    // cálculo do score
    let score = Math.max(0, Math.round(100 - dados.percentual_limite));

    let cor = "#4CAF50";
    if (dados.risco === "moderado") cor = "#FFC107";
    if (dados.risco === "alto") cor = "#F44336";

    resultado.style.backgroundColor = cor;
    resultado.style.color = "white";

    resultado.innerHTML =
      "<h2>Saúde Fiscal: " + score + "/100</h2>" +
      "<b>Risco:</b> " + dados.risco.toUpperCase() +
      "<br>Projeção anual: R$ " + dados.projecao_anual +
      "<br>Uso do limite: " + dados.percentual_limite + "%";

  } catch (erro) {
    resultado.innerHTML = "Erro ao consultar a API.";
  }

  botao.disabled = false;
  botao.innerText = "Analisar risco";
  loading.style.display = "none";
}
</script>
